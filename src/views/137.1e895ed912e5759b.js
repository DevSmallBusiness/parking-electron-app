"use strict";(self.webpackChunkparking_app=self.webpackChunkparking_app||[]).push([[137],{6137:(Ce,m,a)=>{a.r(m),a.d(m,{ChangeHistoryModule:()=>me});var l=a(6895),y=a(8869),e=a(4650),b=a(727),M=a(6451),p=a(262),_=a(9751),T=a(515),h=a(8505),u=a(8746),L=a(9657),C=a(4004),d=a(1917),S=a(635),f=a(7076),H=a(7886),v=a(7482);let x=(()=>{class s{mapChangesHistory(t){return t||t?.length?t.map(this.mapChangeHistory.bind(this)):[]}mapChangeHistory(t){return{_id:t?._id,typeService:(0,v.Fn)(t?.typeService),typeVehicle:(0,H.uK)(t?.typeVehicle),plate:t?.plate,ownerName:t?.ownerName,ownerNumber:t?.ownerNumber,entryDate:t?.entryDate,departureDate:t?.departureDate,receivableValue:t?.receivableValue,moneyPaid:t?.moneyPaid,remainigMoney:t?.remainigMoney,serviceState:(0,f.yC)(t?.serviceState),creationDate:t?.creationDate}}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),w=(()=>{class s{map(t){return{_id:t?._id,typeService:(0,v.vO)(t?.typeService),typeVehicle:(0,H.X2)(t?.typeVehicle),plate:t?.plate,ownerName:t?.ownerName,ownerNumber:t?.ownerNumber,entryDate:t?.entryDate,departureDate:t?.departureDate,creationDate:t?.creationDate,receivableValue:t?.receivableValue,moneyPaid:t?.moneyPaid,remainigMoney:t?.remainigMoney,serviceState:(0,f.I6)(t?.serviceState)}}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})(),A=(()=>{class s{constructor(t,i,n){this.httpService=t,this.apiToChangesHistoryMapper=i,this.toApiChangesHistoryMapper=n}getChangesHistory(){return this.httpService.get(d.y.changesHistory).pipe((0,C.U)(({result:i})=>this.apiToChangesHistoryMapper.mapChangesHistory(i)))}createChangeHistory(t){const i=d.y.changesHistory,n=this.toApiChangesHistoryMapper.map(t);return this.httpService.post(i,n)}updateChangeHistory(t){const i=d.y.changesHistory,n=this.toApiChangesHistoryMapper.map(t);return this.httpService.put(i,n).pipe((0,C.U)(({result:r})=>r?._id))}deleteChangeHistory(t){const i=d.y.deleteChangeHistory(t);return this.httpService.delete(i)}deleteAllChangesHistory(){return this.httpService.delete(d.y.changesHistory)}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(S.O),e.LFG(x),e.LFG(w))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var Z=a(1152);let V=(()=>{class s{constructor(t,i,n){this.state=t,this.changesHistoryService=i,this.resourcesService=n}changesHistory$(){return this.state.changesHistory.changesHistory.$()}currentChangeHistoryToView$(){return this.state.changesHistory.currentChangeHistoryToView.$()}isSidebarClose$(){return this.state.resources.isSidebarClose.$()}isLoading$(){return this.state.resources.isLoading.$()}typesServices$(){return this.state.resources.typesServices.$()}typesVehicles$(){return this.state.resources.typesVehicles.$()}canCloseModal$(){return this.state.resources.canCloseModal.$()}initSubscriptions(){this.subscriptions=new b.w0}destroySubscriptions(){this.subscriptions.unsubscribe()}loadChangesHistory(){this.subscriptions.add(this.changesHistoryService.getChangesHistory().pipe((0,h.b)(this.storeChangesHistory.bind(this))).subscribe())}destroyChangesHistory(){this.state.changesHistory.changesHistory.set([])}loadChangeHistory(t){this.destroyChangeHistory();const i=this.state.changesHistory.changesHistory.snapshot().find(n=>n._id===t);this.state.changesHistory.currentChangeHistoryToView.set(i)}destroyChangeHistory(){this.state.changesHistory.currentChangeHistoryToView.set(null)}loadResources(){this.subscriptions.add((0,M.T)(this.resourcesService.getTypesServices().pipe((0,h.b)(this.storeTypesServices.bind(this))),this.resourcesService.getTypesVehicles().pipe((0,h.b)(this.storeTypesVehicles.bind(this)))).subscribe())}destroyResources(){this.state.resources.typesServices.set([]),this.state.resources.typesVehicles.set([])}createChangeHistory(t){const i=this.loadChangesHistory.bind(this);this.notify("init"),this.subscriptions.add(this.changesHistoryService.createChangeHistory(t).pipe((0,h.b)(this.notify.bind(this,"complete",i)),(0,h.b)(this.storeCanCloseModal.bind(this,!0)),(0,p.K)(this.notify.bind(this,"error",null)),(0,u.x)(this.notifyClose.bind(this))).subscribe())}deleteChangeHistory(t){const i=this.loadChangesHistory.bind(this);this.notify("init"),this.subscriptions.add(this.changesHistoryService.deleteChangeHistory(t).pipe((0,h.b)(this.notify.bind(this,"complete",i)),(0,p.K)(this.notify.bind(this,"error",null)),(0,u.x)(this.notifyClose.bind(this))).subscribe())}deleteAllChangesHistory(){const t=this.loadChangesHistory.bind(this);this.notify("init"),this.subscriptions.add(this.changesHistoryService.deleteAllChangesHistory().pipe((0,h.b)(this.notify.bind(this,"complete",t)),(0,p.K)(this.notify.bind(this,"error",null)),(0,u.x)(this.notifyClose.bind(this))).subscribe())}destroyIsLoading(){this.state.resources.isLoading.set(!0)}destroyCanCloseModal(){this.state.resources.canCloseModal.set(null)}notify(t,i=null){return this.state.notifications.notification.set({init:"Estamos procesando su solicitud",complete:"Su solicitud se complet\xf3 con \xe9xito",error:"El proceso que solicitaste fall\xf3, int\xe9ntalo de nuevo m\xe1s tarde"}[t]),!!i&&!(i instanceof _.y)&&setTimeout(()=>i(),2e3),T.E}notifyClose(t=null){this.canClose()&&setTimeout(()=>{this.state.notifications.notification.set(null),t&&t()},1e3)}canClose(){return!this.state.notifications.notification.snapshot()?.startsWith("La solicitud fall\xf3")}storeChangesHistory(t){this.state.changesHistory.changesHistory.set(t),this.state.resources.isLoading.set(!1)}storeTypesServices(t){this.state.resources.typesServices.set(t)}storeTypesVehicles(t){this.state.resources.typesVehicles.set(t)}storeCanCloseModal(t){this.state.resources.canCloseModal.set(t)}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(L.a),e.LFG(A),e.LFG(Z.z))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})();var D=a(4612),k=a(623),$=a(391),F=a(7261),J=a(3079);const z=["modalDeleteAllRef"],Q=["modalDeleteRef"],R=["modalViewRef"];function O(s,o){if(1&s){const t=e.EpF();e.TgZ(0,"td",12),e._UZ(1,"parking-text",2),e.qZA(),e.TgZ(2,"td",13),e._UZ(3,"parking-text",2),e.qZA(),e.TgZ(4,"td",12),e._UZ(5,"parking-text",2),e.ALo(6,"date"),e.qZA(),e.TgZ(7,"td",12),e._UZ(8,"parking-text",2),e.ALo(9,"date"),e.qZA(),e.TgZ(10,"td",12),e._UZ(11,"parking-text",2),e.ALo(12,"date"),e.qZA(),e.TgZ(13,"td",12),e._UZ(14,"parking-text",2),e.qZA(),e.TgZ(15,"td",12),e._UZ(16,"parking-text",2),e.qZA(),e.TgZ(17,"td",14)(18,"parking-button",15),e.NdJ("clicked",function(){const r=e.CHM(t).item,c=e.oxw(),g=e.MAs(8);return c.handleLoadChangeHistoryToView(r._id),e.KtG(g.toggle())}),e.qZA(),e.TgZ(19,"parking-button",15),e.NdJ("clicked",function(){const r=e.CHM(t).item,c=e.oxw();return e.MAs(12).toggle(),e.KtG(c.setChangeHistoryId(r._id))}),e.qZA()()}if(2&s){const t=o.item;e.xp6(1),e.Q6J("text",null==t?null:t.plate)("weight","bold")("size","base")("color","white"),e.xp6(2),e.Q6J("text",null==t?null:t.ownerName)("weight","bold")("size","base")("color","white"),e.xp6(2),e.Q6J("text",e.xi3(6,34,null==t?null:t.creationDate,"dd-MM-yyyy"))("weight","bold")("size","base")("color","white"),e.xp6(3),e.Q6J("text",e.xi3(9,37,null==t?null:t.entryDate,"dd-MM-yyyy"))("weight","bold")("size","base")("color","white"),e.xp6(3),e.Q6J("text",e.xi3(12,40,null==t?null:t.departureDate,"dd-MM-yyyy"))("weight","bold")("size","base")("color","white"),e.xp6(3),e.Q6J("text",null==t?null:t.typeService)("weight","bold")("size","base")("color","white"),e.xp6(2),e.Q6J("text",null==t?null:t.serviceState)("weight","bold")("size","base")("color","white"),e.xp6(2),e.Q6J("display","block")("icon","message-square-detail")("type","static"),e.xp6(1),e.Q6J("display","block")("icon","trash-alt")("type","static")}}const G=function(){return["Placa","4rem"]},I=function(){return["Nombre","4rem"]},N=function(){return["Fecha de Creaci\xf3n","4rem"]},P=function(){return["Fecha de Ingreso","4rem"]},U=function(){return["Fecha de Salida","4rem"]},Y=function(){return["Tipo de Servicio","4rem"]},B=function(){return["Estado del Servicio","4rem"]},E=function(){return["Acciones","2rem"]},K=function(s,o,t,i,n,r,c,g){return[s,o,t,i,n,r,c,g]},j=function(){return[]};let X=(()=>{class s{constructor(t){this.cdRef=t,this.deleteChangeHistory=new e.vpe,this.deleteAllHistory=new e.vpe,this.loadChangeHistoryToView=new e.vpe}ngOnChanges(){!this.canCloseModal||(this.modalDeleteAllRef?.close(),this.modalDeleteRef?.close(),this.modalViewRef?.close(),this.cdRef.detectChanges())}handleDeleteAllHistory(){this.deleteAllHistory.emit()}handleDeleteChangeHistory(){this.deleteChangeHistory.emit(this.changeHistoryId)}handleLoadChangeHistoryToView(t){this.loadChangeHistoryToView.emit(t)}setChangeHistoryId(t){this.changeHistoryId=t}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(e.sBO))},s.\u0275cmp=e.Xpm({type:s,selectors:[["parking-changes-history-list"]],viewQuery:function(t,i){if(1&t&&(e.Gf(z,5),e.Gf(Q,5),e.Gf(R,5)),2&t){let n;e.iGM(n=e.CRH())&&(i.modalDeleteAllRef=n.first),e.iGM(n=e.CRH())&&(i.modalDeleteRef=n.first),e.iGM(n=e.CRH())&&(i.modalViewRef=n.first)}},inputs:{changesHistory:"changesHistory",changeToView:"changeToView",isSidebarClose:"isSidebarClose",isLoading:"isLoading",typesServices:"typesServices",typesVehicles:"typesVehicles",canCloseModal:"canCloseModal",filter:"filter"},outputs:{deleteChangeHistory:"deleteChangeHistory",deleteAllHistory:"deleteAllHistory",loadChangeHistoryToView:"loadChangeHistoryToView"},features:[e.TTD],decls:21,vars:49,consts:[[1,"changes-history__wrapper"],[1,"changes-history__header"],[3,"text","weight","size","color"],[3,"type","display","icon","label","clicked"],[3,"headers","items","itemTemplateRef","isLoading"],["changesHistoryTemplate",""],["modalViewRef",""],[3,"dataInput","canResetForm","typesServices","typesVehicles","disabled"],[3,"auto"],["modalDeleteRef",""],[1,"changes-history__button",3,"label","type","clicked"],["modalDeleteAllRef",""],[1,"changes-history__td"],[1,"vehicles-records__td"],[1,"changes-history__td","changes-history__td--buttons"],[3,"display","icon","type","clicked"]],template:function(t,i){if(1&t){const n=e.EpF();e.TgZ(0,"div",0)(1,"div",1),e._UZ(2,"parking-text",2),e.TgZ(3,"parking-button",3),e.NdJ("clicked",function(){e.CHM(n);const c=e.MAs(17);return e.KtG(c.toggle())}),e.qZA()(),e._UZ(4,"parking-table",4),e.qZA(),e.YNc(5,O,20,43,"ng-template",null,5,e.W1O),e.TgZ(7,"parking-modal",null,6),e.ynx(9),e._UZ(10,"parking-form-vehicle",7),e.BQk(),e.qZA(),e.TgZ(11,"parking-modal",8,9),e.ynx(13),e._UZ(14,"parking-text",2),e.TgZ(15,"parking-button",10),e.NdJ("clicked",function(){return e.CHM(n),e.MAs(12).toggle(),e.KtG(i.handleDeleteChangeHistory())}),e.qZA(),e.BQk(),e.qZA(),e.TgZ(16,"parking-modal",8,11),e.ynx(18),e._UZ(19,"parking-text",2),e.TgZ(20,"parking-button",10),e.NdJ("clicked",function(){return e.CHM(n),e.MAs(17).toggle(),e.KtG(i.handleDeleteAllHistory())}),e.qZA(),e.BQk(),e.qZA()}if(2&t){const n=e.MAs(6);e.xp6(2),e.Q6J("text","Historial de Cambios")("weight","bold")("size","medium")("color","white"),e.xp6(1),e.Q6J("type","static")("display","inline")("icon","trash-alt")("label","ELiminar todo"),e.xp6(1),e.Q6J("headers",e.qlk(39,K,e.DdM(31,G),e.DdM(32,I),e.DdM(33,N),e.DdM(34,P),e.DdM(35,U),e.DdM(36,Y),e.DdM(37,B),e.DdM(38,E)))("items",i.changesHistory||e.DdM(48,j))("itemTemplateRef",n)("isLoading",i.isLoading),e.xp6(6),e.Q6J("dataInput",i.changeToView)("canResetForm",i.canCloseModal)("typesServices",i.typesServices)("typesVehicles",i.typesVehicles)("disabled",!0),e.xp6(1),e.Q6J("auto",!0),e.xp6(3),e.Q6J("text","\xbfEst\xe1s seguro de que deseas eliminar este registro?")("weight","bold")("size","medium")("color","white"),e.xp6(1),e.Q6J("label","Eliminar")("type","static"),e.xp6(1),e.Q6J("auto",!0),e.xp6(3),e.Q6J("text","\xbfEst\xe1s seguro de que deseas eliminar todos los registros?")("weight","bold")("size","medium")("color","white"),e.xp6(1),e.Q6J("label","Eliminar")("type","static")}},dependencies:[D.a,k.T,$.r,F.z,J.b,l.uU],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@200;400&display=swap";@keyframes scale-up-top{0%{transform:scaleX(.5);transform-origin:0% 0%}to{transform:scaleX(1);transform-origin:0% 0%}}@keyframes scale-up-tl{0%{transform:scale(.5);transform-origin:0% 0%}to{transform:scale(1);transform-origin:0% 0%}}@keyframes jumping{0%{opacity:.3;transform:translateY(0)}20%{opacity:1;transform:translateY(-3px)}40%{opacity:.3;transform:translateY(0)}to{opacity:.3;transform:translateY(0)}}.changes-history__wrapper{position:relative;min-height:33.125rem;height:100%;background:linear-gradient(rgba(56,139,253,.1),rgba(56,139,253,.1));border-color:#388bfd1a;color:#e0e0e0;padding:1.875rem;width:100%}.changes-history__header{padding-top:1.875rem;display:flex;justify-content:space-between;margin-bottom:2rem}.changes-history__header-right{display:flex;justify-content:flex-end;align-items:center;flex-wrap:wrap;gap:1rem}.changes-history__td{padding:.5rem;max-width:10rem}.changes-history__td--buttons{display:flex;justify-content:center;align-items:center;gap:1rem;max-width:100%}.changes-history__button{display:flex;justify-content:center;margin-top:1rem}@media (max-width: 480px){.changes-history__header{text-align:center;gap:.625rem;flex-direction:column;align-items:center;justify-content:center;font-size:.938rem}.changes-history__header-right{justify-content:center}}\n'],encapsulation:2,changeDetection:0}),s})();const W=function(s){return{"changes-history__container--active":s}};function q(s,o){if(1&s){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",1)(2,"div",2)(3,"parking-changes-history-list",3),e.NdJ("deleteChangeHistory",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.handleDeleteChangeHistory(n))})("deleteAllHistory",function(){e.CHM(t);const n=e.oxw();return e.KtG(n.handleDeleteAllHistory())})("loadChangeHistoryToView",function(n){e.CHM(t);const r=e.oxw();return e.KtG(r.handleLoadChangeHistoryToView(n))}),e.qZA()()(),e.BQk()}if(2&s){const t=o.ngIf;e.xp6(1),e.Q6J("ngClass",e.VKq(8,W,!t.isSidebarClose)),e.xp6(2),e.Q6J("changesHistory",t.changesHistory)("changeToView",t.changeToView)("isLoading",t.isLoading)("typesServices",t.typesServices)("typesVehicles",t.typesVehicles)("isSidebarClose",t.isSidebarClose)("canCloseModal",t.canCloseModal)}}const ee=function(s,o,t,i,n,r,c){return{changesHistory:s,changeToView:o,isSidebarClose:t,isLoading:i,typesServices:n,typesVehicles:r,canCloseModal:c}};let te=(()=>{class s{constructor(t){this.facade=t}ngOnInit(){this.facade.initSubscriptions(),this.facade.loadChangesHistory(),this.facade.loadResources(),this.initializeSubscriptions()}ngOnDestroy(){this.facade.destroyChangesHistory(),this.facade.destroyIsLoading(),this.facade.destroyResources(),this.facade.destroySubscriptions()}handleDeleteChangeHistory(t){this.facade.deleteChangeHistory(t)}handleDeleteAllHistory(){this.facade.deleteAllChangesHistory()}handleLoadChangeHistoryToView(t){this.facade.destroyCanCloseModal(),this.facade.loadChangeHistory(t)}initializeSubscriptions(){this.changesHistory$=this.facade.changesHistory$(),this.isSidebarClose$=this.facade.isSidebarClose$(),this.changeToView$=this.facade.currentChangeHistoryToView$(),this.isSidebarClose$=this.facade.isSidebarClose$(),this.isLoading$=this.facade.isLoading$(),this.typesServices$=this.facade.typesServices$(),this.typesVehicles$=this.facade.typesVehicles$(),this.canCloseModal$=this.facade.canCloseModal$()}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(V))},s.\u0275cmp=e.Xpm({type:s,selectors:[["parking-changes-history-list-container"]],decls:8,vars:23,consts:[[4,"ngIf"],[1,"changes-history__container",3,"ngClass"],[1,"changes-history__content"],[3,"changesHistory","changeToView","isLoading","typesServices","typesVehicles","isSidebarClose","canCloseModal","deleteChangeHistory","deleteAllHistory","loadChangeHistoryToView"]],template:function(t,i){1&t&&(e.YNc(0,q,4,10,"ng-container",0),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.ALo(6,"async"),e.ALo(7,"async")),2&t&&e.Q6J("ngIf",e.Hh0(15,ee,e.lcZ(1,1,i.changesHistory$),e.lcZ(2,3,i.changeToView$),e.lcZ(3,5,i.isSidebarClose$),e.lcZ(4,7,i.isLoading$),e.lcZ(5,9,i.typesServices$),e.lcZ(6,11,i.typesVehicles$),e.lcZ(7,13,i.canCloseModal$)))},dependencies:[l.mk,l.O5,X,l.Ov],styles:['@import"https://fonts.googleapis.com/css2?family=Poppins:wght@200;400&display=swap";@keyframes _ngcontent-%COMP%_scale-up-top{0%{transform:scaleX(.5);transform-origin:0% 0%}to{transform:scaleX(1);transform-origin:0% 0%}}@keyframes _ngcontent-%COMP%_scale-up-tl{0%{transform:scale(.5);transform-origin:0% 0%}to{transform:scale(1);transform-origin:0% 0%}}@keyframes _ngcontent-%COMP%_jumping{0%{opacity:.3;transform:translateY(0)}20%{opacity:1;transform:translateY(-3px)}40%{opacity:.3;transform:translateY(0)}to{opacity:.3;transform:translateY(0)}}.changes-history[_ngcontent-%COMP%]{position:relative;width:100%}.changes-history__container[_ngcontent-%COMP%]{position:absolute;width:calc(100% - 215px);left:13rem;min-height:100vh;transition:.5s}.changes-history__container--active[_ngcontent-%COMP%]{width:calc(100% - 60px);left:3.75rem}.changes-history__content[_ngcontent-%COMP%]{position:relative;width:100%;padding:1.25rem;margin-top:1.563rem;padding-top:0}@media (max-width: 992px){.changes-history__container[_ngcontent-%COMP%]{width:100%;left:0}.changes-history__container--active[_ngcontent-%COMP%]{width:calc(100% - 300px);left:18.75rem}}@media (max-width: 480px){.changes-history__container--active[_ngcontent-%COMP%]{width:100%;left:0}}'],changeDetection:0}),s})();var se=a(4969);const ie=[{path:"",component:(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["parking-layout-change-history"]],decls:5,vars:0,consts:[[1,"layout-change-history"],["name","header"]],template:function(t,i){1&t&&(e.TgZ(0,"section",0)(1,"header"),e._UZ(2,"router-outlet",1),e.qZA(),e.TgZ(3,"section"),e._UZ(4,"router-outlet"),e.qZA()())},dependencies:[y.lC],styles:[".layout-change-history[_ngcontent-%COMP%]{position:relative;width:100%}"],changeDetection:0}),s})(),children:[{path:"",component:se.E,outlet:"header"},{path:"",component:te}]}];let ne=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[y.Bz.forChild(ie),y.Bz]}),s})(),oe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[l.ez,y.Bz]}),s})();var ae=a(4202),re=a(4361),ce=a(1074),le=a(6282),he=a(6419),de=a(5318),ye=a(4922),ge=a(5834);let pe=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[l.ez,he.U,de.Y,re.h,le.z,ce.u,ye.B,ge.K]}),s})(),ue=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[l.ez,pe]}),s})(),me=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[l.ez,ne,oe,ae.a,ue]}),s})()}}]);